[TOC]
# 数据安全与性能保障
## 一、持久化选项
Redis 提供了两种不同的持久化方法来将数据存储到硬盘里面。 一种叫快照（snapshotting），它可以将存在于某一时刻的所有数据都写入到硬盘里面。另一种方式叫只追加文件（append-only file, AOF）,它会在执行命令时，将被执行的写命令复制到硬盘里面。这两种持久化方法既可以同时使用，又可以单独使用，在某些情况下甚至可以两种方法都不使用，具体选择哪种持久化方式，需要根据用户的数据以及应用来决定。
### 1.快照持久化
Redis 可以通过创建快照来获得储存在内存里面的数据在某个时间点上的副本。在创建快照之后，用户可以对快照进行备份，可以将快照复制到其他服务器从而创建具有相同数据的服务器脚本，还可以将快照留在原地以便重启服务器使用。

**创建快照的办法**
1 客户端向 Redis 发送 *BGSAVE* 命令来创建快照，Redis 会调用 fork 来创建一个子进程，然后子进程负责将快照写入硬盘， 而父进程则继续处理命令请求。（Windows平台不支持）

2 客户端向 Redis 发送 *SAVE* 命令来创建一个快照，接到 *SAVE* 命令的 Redis 服务器在快照创建完毕之前将不再响应任何其他命令。 *SAVE* 命令并不常用，我们通常只会在没有足够内存去执行 *BGSAVE* 命令的情况下， 又或者即使等待持久化操作执行完毕也无所谓的情况下，才会使用这个命令。

3 如果用户设置了 *SAVE* 配置选项， 比如 *save 60 10000* ，那么从 Redis 最近一次创建快照之后开始算起，当 “60秒内有10 000次写入” 这个条件满足时， Redis 就会自动触发 *BGSAVE* 命令。如果用户设置了多个 *save* 配置选项，那么当任意一个 *save* 配置选项所设置的条件被满足时， Redis 就会触发一次 *BGSAVE* 命令。

4 当 Redis 通过 *SHUTDOWN* 命令接收到关闭服务器的请求时， 或者接收到标准 *TERM* 信号时，会执行一个 *SAVE* 命令，阻塞所有客户端，不再执行客户端发送的任何命令，并在 *SAVE* 命令执行完毕之后关闭服务器。

5 当一个 Redis 服务器连接另一个 Redis 服务器，并向对方发送 *SYNC* 命令来开始一次复制操作的时候， 如果主服务器目前没有执行 *BGSAVE* 操作，或者主服务器并非刚刚执行完 *BGSAVE* 操作，那么主服务器就会执行 *BGSAVE* 命令。

在只使用快照持久化来保存数据时， 一定要记住： 如果系统真的发生崩溃，用户将丢失最近一次生成快照之后更改的所有数据。因此，快照持久化只适用于那些即使丢失一部分数据也不会造成问题的应用程序，而不能接受这种数据损失的应用程序则可以考虑使用 AOF 持久化。
### 2.只追加文件 (AOF)
AOF(append-only file)持久化，它会在执行命令式, 将被执行的写命令复制到硬盘里面.